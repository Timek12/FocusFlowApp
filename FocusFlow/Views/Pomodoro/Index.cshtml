@model PomodoroSession

<div class="justify-content-center border">
    <div class="card text-center">
        <div class="card-header">
            <h1>
                Pomodoro
            </h1>
        </div>
        <div class="card-body justify-content-center">
            <div class="row mt-3">
                <div class="col-md-4 text-center">
                    <button id="startTimerButton" class="btn btn-primary w-75">START</button>
                </div>
                <div class="col-md-4 text-center">
                    <button id="stopTimerButton" class="btn btn-primary w-75">STOP</button>
                </div>
                <div class="col-md-4 text-center">
                    <button id="resetTimerButton" class="btn btn-primary w-75">RESET</button>
                </div>
            </div>

            <div class="col-md-10 offset-md-1">
                <h1 id="time" style="font-size: 7em">
                    @Model.Duration.ToString(@"hh\:mm\:ss")
                </h1>
            </div>
        </div>
    </div>
</div>

<script>
    let duration = @Model.Duration.TotalSeconds;
    let timer = duration;
    let display = document.querySelector('#time');
    let startTimerButton = document.querySelector('#startTimerButton');
    let stopTimerButton = document.querySelector('#stopTimerButton');
    let resetTimerButton = document.querySelector('#resetTimerButton');
    let timerInterval;

    startTimerButton.addEventListener('click', function () {
        startTimer(duration, display);
    });

    stopTimerButton.addEventListener('click', function () {
        stopTimer();
    });

    resetTimerButton.addEventListener('click', function () {
        resetTimer();
    });

    function startTimer(duration, display) {
        let hours, minutes, seconds;
        timerInterval = setInterval(function () {
            display.textContent = formatTime(timer);

            if (--timer < 0) {
                // ajax call to server
                stopTimer();
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function resetTimer() {
        timer = duration;
        stopTimer();
        display.textContent = formatTime(timer);
    }

    function formatTime(timeInSeconds) {
        let hours = parseInt(timeInSeconds / 3600, 10);
        let minutes = parseInt(timeInSeconds / 60, 10);
        let seconds = parseInt(timeInSeconds % 60, 10);

        hours = hours < 10 ? "0" + hours : hours;
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        if (timeInSeconds >= 3600) {
            return hours + ":" + minutes + ":" + seconds;
        }
        else {
            return minutes + ":" + seconds;
        }
    }

</script>
